# QQ机器人管理插件

基于Nonebot2和OneBot V11适配器开发的QQ机器人管理插件，提供机器人信息查询、个性签名修改、头像更换和在线状态设置等功能。

## 功能特性

### 1. 机器人信息查询 `/机器人信息`
- **功能**: 获取并显示机器人的详细信息
- **API接口**: 
  - `get_login_info` - 获取登录信息
  - `get_status` - 获取状态信息  
  - `get_version_info` - 获取版本信息
- **包含信息**:
  - QQ号和昵称
  - 在线/离线状态
  - 消息统计（收发数量、断开次数等）
  - 应用版本和协议版本信息

### 2. 修改个性签名 `/修改个性签名 <内容>`
- **功能**: 修改机器人的个性签名
- **API接口**: `set_self_longnick`
- **示例**: `/修改个性签名 这是我的新签名`

### 3. 修改头像 `/修改头像`
- **功能**: 修改机器人头像，支持图片上传
- **API接口**: `set_qq_avatar`
- **使用流程**:
  1. 发送命令 `/修改头像`
  2. 在30秒内发送图片文件
  3. 系统自动更换头像
- **取消方式**: 发送 `取消上传` 或等待30秒超时

### 4. 在线状态设置 `/状态设置`
- **功能**: 修改机器人的在线状态，支持40+种状态
- **API接口**: `set_online_status`
- **状态分类**:
  - **基础状态 (1-6)**: 在线、离开、隐身、忙碌、Q我吧、请勿打扰
  - **娱乐状态 (7-9)**: 听歌中、timi中、追剧中
  - **学习工作 (10-13)**: 学习中、肝作业、搬砖中、摸鱼中
  - **生活状态 (14-17)**: 睡觉中、熬夜中、去旅行、出去浪
  - **情绪状态 (18-24)**: 恋爱中、爱你、emo中、我太难了、我想开了、我没事、想静静
  - **特殊状态 (25-30)**: 元气满满、嗨到飞起、好运锦鲤、宝宝认证、无聊中、悠哉哉
  - **其他状态 (31-40)**: 信号弱、今日天气、我crash了、被掏空、难得糊涂、一言难尽、一起元梦、求星搭子、春日限定、水逆退散
  - **电量状态 (50)**: 我的电量50%
- **使用方法**: 
  - `/状态设置` - 查看所有状态列表
  - `/状态设置 18` - 设置为"恋爱中"
  - `/状态设置 13` - 设置为"摸鱼中"

### 5. 帮助功能 `/帮助`
- **功能**: 显示所有可用功能的帮助信息

## 安装配置

### 1. 安装依赖
```bash
pip install -r requirements.txt
```

### 2. 配置文件
复制 `.env.example` 为 `.env` 并配置以下内容：

```env
# OneBot V11 连接配置
ONEBOT_V11_WS_URLS=["ws://127.0.0.1:8080/onebot/v11/ws"]

# 服务器配置
HOST=127.0.0.1
PORT=8000

# 超级用户配置（可使用所有功能的QQ号）
SUPERUSERS=["123456789"]

# 插件配置
QQESSENTIALS_AVATAR_UPLOAD_TIMEOUT=30
```

### 3. 运行机器人
```bash
python bot.py
# 或者使用测试脚本
python test_bot.py
```

## 项目结构
```
QQBot/
├── bot.py                 # 主启动文件
├── test_bot.py           # 测试启动脚本
├── plugins/
│   └── qqessentials/     # 插件目录
│       ├── __init__.py   # 插件初始化
│       ├── __main__.py   # 主功能实现
│       └── config.py     # 配置类
├── requirements.txt      # 依赖包
├── .env.example         # 配置文件示例
└── README.md           # 说明文档
```

## API参考

本插件基于 [OneBot V11 标准](https://napneko.github.io/onebot/api) 实现，使用的主要API：

- `get_login_info` - 获取登录号信息
- `get_status` - 获取状态信息
- `get_version_info` - 获取版本信息
- `set_self_longnick` - 设置个性签名
- `set_qq_avatar` - 设置头像
- `set_online_status` - 设置在线状态

## 注意事项

1. **权限要求**: 机器人需要有相应的权限才能执行修改操作
2. **超时设置**: 头像上传默认30秒超时，可在配置中修改
3. **图片格式**: 头像支持常见图片格式（JPG、PNG等）
4. **状态限制**: 部分在线状态可能受到QQ客户端限制

## 故障排除

### 常见问题
1. **API调用失败**: 检查OneBot实现是否支持对应API
2. **权限不足**: 确认机器人账号具有相应操作权限
3. **连接问题**: 检查OneBot连接配置是否正确

### 调试方法
- 查看控制台日志输出
- 确认OneBot服务正常运行
- 测试基础消息收发功能
- `ONEBOT_WS_URLS`: OneBot V11连接地址
- `AVATAR_UPLOAD_TIMEOUT`: 头像上传超时时间（秒），默认30秒

### 3. 配置OneBot实现
推荐使用 [go-cqhttp](https://github.com/Mrs4s/go-cqhttp)，在其配置文件中添加：
```yaml
servers:
  - ws-reverse:
      universal: ws://127.0.0.1:8080/onebot/v11/ws/
      reconnect-interval: 3000
```

### 4. 启动机器人
```bash
python bot.py
```

## 注意事项

1. **权限要求**: 所有命令都需要超级用户权限
2. **API支持**: 需要OneBot实现支持相应的API接口
3. **头像格式**: 支持常见的图片格式（jpg、png等）
4. **网络连接**: 确保机器人与OneBot实现之间的网络连接正常

## API接口说明

本插件使用了以下OneBot V11 API接口：
- `get_login_info`: 获取登录信息
- `get_status`: 获取运行状态
- `get_version_info`: 获取版本信息
- `set_self_longnick`: 设置个性签名
- `set_qq_avatar`: 设置QQ头像
- `set_online_status`: 设置在线状态

## 故障排除

### 常见问题
1. **命令无响应**: 检查是否为超级用户，确认配置文件正确
2. **API调用失败**: 确认OneBot实现支持相应接口
3. **连接问题**: 检查网络连接和端口配置
4. **权限不足**: 确认QQ号在超级用户列表中

### 日志查看
机器人启动时会显示加载的命令列表，可以通过日志确认插件是否正常加载。

## 开发信息

- **开发框架**: NoneBot2
- **适配器**: OneBot V11
- **Python版本**: >=3.9
- **许可证**: MIT

## 更新日志

### v1.1.0
- 添加头像上传超时时间可配置功能
- 通过 `AVATAR_UPLOAD_TIMEOUT` 环境变量配置超时时间
- 改进启动日志显示当前配置信息

### v1.0.0
- 实现机器人信息查询功能
- 实现个性签名修改功能
- 实现头像更换功能（支持超时和取消）
- 实现在线状态设置功能
- 添加超级用户权限控制
